# AgentGroupChat vs GroupChatOrchestration å¯¹æ¯”åˆ†æ

## ğŸ“Š æ ¸å¿ƒå·®å¼‚å¯¹æ¯”

| ç‰¹æ€§ç»´åº¦ | AgentGroupChatï¼ˆå·²å¼ƒç”¨ï¼‰ | GroupChatOrchestrationï¼ˆæ¨èï¼‰ |
|---------|-------------------------|---------------------------|
| **ç»´æŠ¤çŠ¶æ€** | âŒ å·²å¼ƒç”¨ï¼Œä¸å†ç»´æŠ¤ | âœ… å½“å‰ç»´æŠ¤å’Œæ¨è |
| **æ¶æ„æ¨¡å¼** | ä¼ ç»Ÿä»£ç†ç¾¤èŠ | ç°ä»£ç¼–æ’æ¡†æ¶ |
| **ç¼–æ’æ”¯æŒ** | ä»…æ”¯æŒç¾¤èŠæ¨¡å¼ | æ”¯æŒå¤šç§ç¼–æ’æ¨¡å¼ |
| **é€‰æ‹©ç­–ç•¥** | å¿…é¡»æä¾›é€‰æ‹©ç­–ç•¥ | å¯é€‰æ‹©ç­–ç•¥ï¼ˆç¾¤èŠæ¨¡å¼ï¼‰ |
| **ç»ˆæ­¢ç­–ç•¥** | æ”¯æŒè‡ªå®šä¹‰ç»ˆæ­¢ç­–ç•¥ | æ”¯æŒæ›´çµæ´»çš„ç»ˆæ­¢ç­–ç•¥ |
| **æ¶ˆæ¯ç®¡ç†** | åŸºç¡€æ¶ˆæ¯ç®¡ç† | å¢å¼ºçš„æ¶ˆæ¯ç®¡ç† |
| **æ‰©å±•æ€§** | ç›¸å¯¹å›ºå®š | é«˜åº¦å¯æ‰©å±• |
| **é”™è¯¯å¤„ç†** | åŸºç¡€é”™è¯¯å¤„ç† | å¢å¼ºçš„é”™è¯¯å¤„ç† |
| **æ€§èƒ½** | åŸºç¡€æ€§èƒ½ | ä¼˜åŒ–çš„æ€§èƒ½ |
| **æ–‡æ¡£æ”¯æŒ** | æ–‡æ¡£ä¸å†æ›´æ–° | å®Œæ•´çš„æ–‡æ¡£æ”¯æŒ |

## ğŸ”„ è¿ç§»å¯¹æ¯”

### 1. åŸºç¡€ç”¨æ³•å¯¹æ¯”

#### AgentGroupChatï¼ˆæ—§ç‰ˆï¼‰
```python
from semantic_kernel.agents import AgentGroupChat

# åˆ›å»ºä»£ç†ç¾¤èŠ
group_chat = AgentGroupChat(
    agents=[agent1, agent2, agent3],
    selection_strategy=CustomSelectionStrategy(),
    termination_strategy=CustomTerminationStrategy(agents=agents)
)

# æ·»åŠ æ¶ˆæ¯
await group_chat.add_chat_message(
    ChatMessageContent(role=AuthorRole.USER, content="è¯·åä½œå®Œæˆä»»åŠ¡")
)

# æ‰§è¡Œåä½œ
async for response in group_chat.invoke():
    print(f"==== {response.name} å“åº” ====")
```

#### GroupChatOrchestrationï¼ˆæ–°ç‰ˆï¼‰
```python
from semantic_kernel.agents.orchestration.group_chat import GroupChatOrchestration

# åˆ›å»ºç¾¤èŠç¼–æ’
group_chat = GroupChatOrchestration(
    agents=[agent1, agent2, agent3],
    selection_strategy=CustomSelectionStrategy(),
    termination_strategy=CustomTerminationStrategy()
)

# ç›´æ¥è°ƒç”¨
result = await group_chat.invoke(
    "è¯·åä½œå®Œæˆä»»åŠ¡",
    cancellation_token=cancellation_token
)
```

### 2. æ¶ˆæ¯å¤„ç†å¯¹æ¯”

#### AgentGroupChat æ¶ˆæ¯å¤„ç†
```python
# éœ€è¦æ‰‹åŠ¨æ·»åŠ æ¶ˆæ¯åˆ°å¯¹è¯å†å²
await group_chat.add_chat_message(
    ChatMessageContent(role=AuthorRole.USER, content="ç”¨æˆ·è¾“å…¥")
)

# è·å–èŠå¤©å†å²
async for message in group_chat.get_chat_messages():
    print(f"{message.name}: {message.content}")
```

#### GroupChatOrchestration æ¶ˆæ¯å¤„ç†
```python
# ç›´æ¥é€šè¿‡ invoke æ–¹æ³•å¤„ç†æ¶ˆæ¯
result = await group_chat.invoke(
    "ç”¨æˆ·è¾“å…¥",
    cancellation_token=cancellation_token
)

# ç»“æœç›´æ¥è¿”å›ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†æ¶ˆæ¯å†å²
print(f"æœ€ç»ˆç»“æœ: {result}")
```

### 3. é€‰æ‹©ç­–ç•¥å¯¹æ¯”

#### AgentGroupChat é€‰æ‹©ç­–ç•¥
```python
class CustomSelectionStrategy(SelectionStrategy):
    def __init__(self):
        self.agents = None
    
    async def next(
        self,
        agents: list[Agent],
        history: list[ChatMessageContent],
        cancellation_token: CancellationToken = CancellationToken.none(),
    ) -> Agent:
        # é€‰æ‹©é€»è¾‘
        return selected_agent
```

#### GroupChatOrchestration é€‰æ‹©ç­–ç•¥
```python
# ç»§æ‰¿ç›¸åŒçš„ SelectionStrategy åŸºç±»
class CustomSelectionStrategy(SelectionStrategy):
    async def next(
        self,
        agents: list[Agent],
        history: list[ChatMessageContent],
        cancellation_token: CancellationToken = CancellationToken.none(),
    ) -> Agent:
        # é€‰æ‹©é€»è¾‘ï¼ˆç›¸åŒæ¥å£ï¼‰
        return selected_agent

# ä½†æä¾›äº†æ›´å¤šé¢„å®šä¹‰ç­–ç•¥
from semantic_kernel.agents.strategies.selection.sequential_selection_strategy import SequentialSelectionStrategy
from semantic_kernel.agents.strategies.selection.kernel_function_selection_strategy import KernelFunctionSelectionStrategy
```

## ğŸš¨ é‡è¦è¡¥å……ï¼šGroupChatManager æ¶æ„

é€šè¿‡æºä»£ç åˆ†æå‘ç°ï¼Œ`GroupChatOrchestration` å¼•å…¥äº†å…¨æ–°çš„ **`GroupChatManager`** æ¶æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å¤§çš„è®¾è®¡å˜åŒ–ï¼š

### æ–°æ¶æ„æ ¸å¿ƒç»„ä»¶

#### 1. GroupChatManagerï¼ˆæŠ½è±¡åŸºç±»ï¼‰
```python
@experimental
class GroupChatManager(KernelBaseModel, ABC):
    """ç¾¤èŠç®¡ç†å™¨ï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ªç¾¤èŠæµç¨‹"""
    
    current_round: int = 0
    max_rounds: int | None = None
    human_response_function: Callable | None = None
    
    # æ ¸å¿ƒæ–¹æ³•
    async def should_request_user_input(self, chat_history: ChatHistory) -> BooleanResult
    async def should_terminate(self, chat_history: ChatHistory) -> BooleanResult
    async def select_next_agent(self, chat_history: ChatHistory, participant_descriptions: dict[str, str]) -> StringResult
    async def filter_results(self, chat_history: ChatHistory) -> MessageResult
```

#### 2. RoundRobinGroupChatManagerï¼ˆé»˜è®¤å®ç°ï¼‰
```python
@experimental
class RoundRobinGroupChatManager(GroupChatManager):
    """è½®è¯¢ç¾¤èŠç®¡ç†å™¨ - å®˜æ–¹æä¾›çš„é»˜è®¤å®ç°"""
    
    current_index: int = 0
    
    # è½®è¯¢é€‰æ‹©ä¸‹ä¸€ä¸ªAgent
    async def select_next_agent(...) -> StringResult:
        next_agent = list(participant_descriptions.keys())[self.current_index]
        self.current_index = (self.current_index + 1) % len(participant_descriptions)
        return StringResult(result=next_agent, reason="Round-robin selection.")
```

### æ¶æ„å¯¹æ¯”æ›´æ–°

| ç»„ä»¶ | AgentGroupChat | GroupChatOrchestration |
|------|---------------|----------------------|
| **Agenté€‰æ‹©** | SelectionStrategy | GroupChatManager.select_next_agent() |
| **ç»ˆæ­¢æ§åˆ¶** | TerminationStrategy | GroupChatManager.should_terminate() |
| **è½®æ•°æ§åˆ¶** | åœ¨Strategyä¸­å®ç° | GroupChatManager.max_rounds |
| **ç”¨æˆ·äº¤äº’** | é€šè¿‡UserAgent | GroupChatManager.should_request_user_input() |
| **ç»“æœå¤„ç†** | æ‰‹åŠ¨å¤„ç† | GroupChatManager.filter_results() |
| **äººå·¥å¹²é¢„** | æ— å†…ç½®æ”¯æŒ | GroupChatManager.human_response_function |

### æ­£ç¡®çš„è¿ç§»æ–¹å¼

```python
# âŒ é”™è¯¯ï¼šç›´æ¥æ›¿æ¢ç±»åï¼ˆä¸å®Œæ•´ï¼‰
group_chat = GroupChatOrchestration(
    agents=agents,
    selection_strategy=CustomSelectionStrategy(),  # æ–°æ¶æ„ä¸æ”¯æŒ
    termination_strategy=CustomTerminationStrategy()  # æ–°æ¶æ„ä¸æ”¯æŒ
)

# âœ… æ­£ç¡®ï¼šä½¿ç”¨ GroupChatManager
# æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤è½®è¯¢ç®¡ç†å™¨
manager = RoundRobinGroupChatManager()
manager.max_rounds = 10

group_chat = GroupChatOrchestration(
    members=agents,  # æ³¨æ„ï¼šå‚æ•°åæ”¹ä¸º members
    manager=manager
)

# æ–¹å¼2ï¼šè‡ªå®šä¹‰ç®¡ç†å™¨ï¼ˆè¿ç§»åŸæœ‰é€»è¾‘ï¼‰
class CustomGroupChatManager(GroupChatManager):
    def __init__(self, original_selection_strategy, original_termination_strategy):
        super().__init__()
        self.selection_strategy = original_selection_strategy
        self.termination_strategy = original_termination_strategy
    
    async def select_next_agent(self, chat_history, participant_descriptions):
        # å°†åŸæœ‰é€‰æ‹©é€»è¾‘è¿ç§»åˆ°è¿™é‡Œ
        selected_agent = await self.selection_strategy.next(...)
        return StringResult(result=selected_agent.name, reason="Custom selection")
    
    async def should_terminate(self, chat_history):
        # å°†åŸæœ‰ç»ˆæ­¢é€»è¾‘è¿ç§»åˆ°è¿™é‡Œ
        should_terminate = await self.termination_strategy.should_agent_terminate(...)
        return BooleanResult(result=should_terminate, reason="Custom termination")

custom_manager = CustomGroupChatManager(
    original_selection_strategy=CustomSelectionStrategy(),
    original_termination_strategy=CustomTerminationStrategy()
)

group_chat = GroupChatOrchestration(
    members=agents,
    manager=custom_manager
)
```

## ğŸš€ è¿ç§»æŒ‡å—

### æ­¥éª¤1ï¼šæ›´æ–°å¯¼å…¥
```python
# æ—§ç‰ˆå¯¼å…¥
from semantic_kernel.agents import AgentGroupChat

# æ–°ç‰ˆå¯¼å…¥
from semantic_kernel.agents.orchestration.group_chat import GroupChatOrchestration
```

### æ­¥éª¤2ï¼šæ›¿æ¢ç±»å
```python
# æ›¿æ¢ç±»å
group_chat = GroupChatOrchestration(  # åŸæ¥æ˜¯ AgentGroupChat
    agents=agents,
    selection_strategy=selection_strategy,
    termination_strategy=termination_strategy
)
```

### æ­¥éª¤3ï¼šè°ƒæ•´æ¶ˆæ¯å¤„ç†
```python
# æ—§ç‰ˆï¼šæ‰‹åŠ¨æ·»åŠ æ¶ˆæ¯
await group_chat.add_chat_message(
    ChatMessageContent(role=AuthorRole.USER, content=user_input)
)
async for response in group_chat.invoke():
    print(f"==== {response.name} å“åº” ====")

# æ–°ç‰ˆï¼šç›´æ¥è°ƒç”¨
result = await group_chat.invoke(
    user_input,
    cancellation_token=cancellation_token
)
```

### æ­¥éª¤4ï¼šæ›´æ–°å“åº”å¤„ç†
```python
# æ—§ç‰ˆï¼šé€šè¿‡å¼‚æ­¥ç”Ÿæˆå™¨å¤„ç†å“åº”
async for response in group_chat.invoke():
    print(f"Agent: {response.name}")
    print(f"Content: {response.content}")

# æ–°ç‰ˆï¼šç›´æ¥å¤„ç†ç»“æœ
result = await group_chat.invoke(user_input)
print(f"æœ€ç»ˆç»“æœ: {result}")
```

### æ­¥éª¤5ï¼šåˆ©ç”¨æ–°ç‰¹æ€§
```python
# ä½¿ç”¨æ–°çš„ç¼–æ’æ¨¡å¼
from semantic_kernel.agents.orchestration.sequential import SequentialOrchestration
from semantic_kernel.agents.orchestration.concurrent import ConcurrentOrchestration

# é¡ºåºç¼–æ’
sequential = SequentialOrchestration(agents=agents)

# å¹¶å‘ç¼–æ’
concurrent = ConcurrentOrchestration(agents=agents)
```

## ğŸ¯ æ¨èçš„æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„ç¼–æ’æ¨¡å¼
```python
# å¤æ‚åä½œåœºæ™¯ï¼šGroupChatOrchestration
group_chat = GroupChatOrchestration(
    agents=[content_agent, review_agent, user_agent],
    selection_strategy=KernelFunctionSelectionStrategy(),
    termination_strategy=custom_termination
)

# ç®€å•é¡ºåºå¤„ç†ï¼šSequentialOrchestration
sequential = SequentialOrchestration(
    agents=[data_agent, analysis_agent, report_agent]
)

# ç‹¬ç«‹å¹¶è¡Œå¤„ç†ï¼šConcurrentOrchestration
concurrent = ConcurrentOrchestration(
    agents=[validator1, validator2, validator3]
)
```

### 2. åˆ©ç”¨é¢„å®šä¹‰ç­–ç•¥
```python
# ä½¿ç”¨å†…ç½®çš„é€‰æ‹©ç­–ç•¥
from semantic_kernel.agents.strategies.selection.sequential_selection_strategy import SequentialSelectionStrategy
from semantic_kernel.agents.strategies.selection.kernel_function_selection_strategy import KernelFunctionSelectionStrategy

# è½®è¯¢é€‰æ‹©
sequential_strategy = SequentialSelectionStrategy()

# AI é©±åŠ¨é€‰æ‹©
function_strategy = KernelFunctionSelectionStrategy(
    function=selection_function,
    kernel=kernel
)
```

### 3. é”™è¯¯å¤„ç†å’Œç›‘æ§
```python
import logging

logger = logging.getLogger(__name__)

try:
    result = await group_chat.invoke(
        user_input,
        cancellation_token=cancellation_token
    )
    logger.info(f"åä½œå®Œæˆ: {result}")
except Exception as e:
    logger.error(f"åä½œå¤±è´¥: {e}")
    # é”™è¯¯å¤„ç†é€»è¾‘
```

## ğŸ’¡ é¡¹ç›®è¿ç§»ç¤ºä¾‹

### å½“å‰é¡¹ç›®è¿ç§»
```python
# æ—§ç‰ˆå®ç° (main.py)
from semantic_kernel.agents import AgentGroupChat

group_chat = AgentGroupChat(
    agents=[
        ContentCreationAgent(),
        UserAgent(),
        CodeValidationAgent(),
    ],
    termination_strategy=CustomTerminationStrategy(agents=agents),
    selection_strategy=CustomSelectionStrategy(),
)

await group_chat.add_chat_message(
    ChatMessageContent(role=AuthorRole.USER, content=TASK.strip())
)

async for response in group_chat.invoke():
    print(f"==== {response.name} just responded ====")
```

### æ¨èçš„æ–°ç‰ˆå®ç°
```python
# æ–°ç‰ˆå®ç°
from semantic_kernel.agents.orchestration.group_chat import GroupChatOrchestration

group_chat = GroupChatOrchestration(
    agents=[
        ContentCreationAgent(),
        UserAgent(),
        CodeValidationAgent(),
    ],
    termination_strategy=CustomTerminationStrategy(),
    selection_strategy=CustomSelectionStrategy(),
)

# æ›´ç®€æ´çš„è°ƒç”¨æ–¹å¼
result = await group_chat.invoke(
    TASK.strip(),
    cancellation_token=CancellationToken.none()
)

print(f"åä½œç»“æœ: {result}")
```

## ğŸ”® æœªæ¥å‘å±•è¶‹åŠ¿

### 1. ç¼–æ’æ¨¡å¼æ‰©å±•
- **åŠ¨æ€ç¼–æ’**ï¼šæ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨é€‰æ‹©ç¼–æ’æ¨¡å¼
- **æ··åˆç¼–æ’**ï¼šç»„åˆå¤šç§ç¼–æ’æ¨¡å¼
- **è‡ªé€‚åº”ç¼–æ’**ï¼šæ ¹æ®æ€§èƒ½å’Œç»“æœè‡ªåŠ¨è°ƒæ•´

### 2. æ™ºèƒ½é€‰æ‹©ç­–ç•¥
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥é€‰æ‹©**ï¼šåŸºäºå¯¹è¯ä¸Šä¸‹æ–‡çš„æ™ºèƒ½é€‰æ‹©
- **å­¦ä¹ å‹é€‰æ‹©**ï¼šä»å†å²å¯¹è¯ä¸­å­¦ä¹ æœ€ä½³é€‰æ‹©
- **å¤šæ¨¡æ€é€‰æ‹©**ï¼šæ”¯æŒæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å¤šæ¨¡æ€è¾“å…¥

### 3. é«˜çº§ç»ˆæ­¢ç­–ç•¥
- **ç›®æ ‡å¯¼å‘ç»ˆæ­¢**ï¼šåŸºäºä»»åŠ¡å®Œæˆåº¦çš„ç»ˆæ­¢
- **è´¨é‡è¯„ä¼°ç»ˆæ­¢**ï¼šåŸºäºè¾“å‡ºè´¨é‡çš„ç»ˆæ­¢
- **èµ„æºçº¦æŸç»ˆæ­¢**ï¼šåŸºäºæ—¶é—´å’Œæˆæœ¬çš„ç»ˆæ­¢

## ğŸ“š ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [GroupChatOrchestration å®˜æ–¹æ–‡æ¡£](https://learn.microsoft.com/semantic-kernel/frameworks/agent/agent-orchestration/group-chat?pivots=programming-language-python)
- [è¿ç§»æŒ‡å—](https://learn.microsoft.com/semantic-kernel/support/migration/group-chat-orchestration-migration-guide?pivots=programming-language-python)

### ç¤ºä¾‹ä»£ç 
- [ç¼–æ’æ¨¡å¼ç¤ºä¾‹](https://github.com/microsoft/semantic-kernel/tree/main/python/samples/demos/agent_orchestration)
- [é€‰æ‹©ç­–ç•¥ç¤ºä¾‹](https://github.com/microsoft/semantic-kernel/tree/main/python/samples/demos/agent_selection)

### ç¤¾åŒºèµ„æº
- [Semantic Kernel ç¤¾åŒºè®¨è®º](https://github.com/microsoft/semantic-kernel/discussions)
- [æœ€ä½³å®è·µåˆ†äº«](https://github.com/microsoft/semantic-kernel/wiki)

## ğŸ† æ€»ç»“

`GroupChatOrchestration` ç›¸æ¯” `AgentGroupChat` çš„ä¸»è¦ä¼˜åŠ¿ï¼š

1. **ğŸ”„ æ›´å¥½çš„ç»´æŠ¤æ€§**ï¼šå®˜æ–¹æŒç»­ç»´æŠ¤å’Œæ›´æ–°
2. **ğŸ¯ æ›´çµæ´»çš„ç¼–æ’**ï¼šæ”¯æŒå¤šç§ç¼–æ’æ¨¡å¼
3. **ğŸš€ æ›´å¥½çš„æ€§èƒ½**ï¼šä¼˜åŒ–çš„æ¶ˆæ¯å¤„ç†å’Œé”™è¯¯å¤„ç†
4. **ğŸ“ˆ æ›´å¼ºçš„æ‰©å±•æ€§**ï¼šæ”¯æŒè‡ªå®šä¹‰ç¼–æ’æ¨¡å¼
5. **ğŸ›¡ï¸ æ›´å¥½çš„ç¨³å®šæ€§**ï¼šæ›´æˆç†Ÿçš„é”™è¯¯å¤„ç†æœºåˆ¶

**å¼ºçƒˆæ¨è**æ‰€æœ‰æ–°é¡¹ç›®ç›´æ¥ä½¿ç”¨ `GroupChatOrchestration`ï¼Œç°æœ‰é¡¹ç›®ä¹Ÿåº”è¯¥å°½å¿«è¿ç§»ä»¥äº«å—æ›´å¥½çš„æ€§èƒ½å’Œç»´æŠ¤æ€§ã€‚
